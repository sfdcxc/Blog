# 《深入理解计算机系统》学习笔记
2019/2/23 12:14:09 
@author: Darcy

## 第一章 计算机系统漫游
- 计算机系统是由硬件和软件组成的，共同工作来运行应用程序。

### 信息就是位+上下位
#### hello程序的生命周期
1. 从一个源程序（源文件）开始的
	- 源程序：程序员通过编辑器创建并保持的文本文件
		- 由值0和1组成的位（又称比特）序列
	- 字节
		- 8个位被组织成一组
	- hello.c程序是以字节序列的方式存储在文件中。
		- 每个字节都有一个整数值，对应某些字符
	- 文本文件
		- 只由ASCII字符构成的文件
	- 二进制文件
		- 所有其他文件
2. 源程序被其他程序翻译成不同的格式
	- GCC编译器驱动程序读取源程序文件hello.c,并把它翻译成一个可执行的目标文件hello.
	- 翻译过程由四个阶段的程序(预处理器cpp,编译器ccl,汇编器as,链接器ld)构成编译系统(compilation system)
	- 预处理阶段
		- 预处理器根据以字符#开头的命令，修改原始的c程序。以i作为文件扩张名
	- 编译阶段
		- 预处理器将文本文件hello.i翻译成文本文件hello.s,包含一个汇编语言程序。
	- 汇编阶段
		- 汇编器将hello.s翻译成机器语言指令，把这些指令打包成一种可重定位目标的格式，保持在目标文件hello.o中。hello.o是一个二进制文件
	- 链接阶段
		- 链接器负责处理调用文件的合并，结果就是得到的hello文件

### 基本思想
- 系统中的所有的信息-包括磁盘文件，内存中的程序，内存中存放的用户数据以及网络上传送的数据，都是由一串比特表示的。区分不同数据对象的唯一方法是我们读到这些数据对象时的上下文。

#### 系统的硬件组成
- ![](https://i.imgur.com/l5S76En.jpg)
1. 总线
	- 贯穿整个系统的一组电子管道，携带信息字节并负责在各个部件间传递。通常总线被设计成传送字长的字节块，也就是字。
	- 字长
		- 一个基本的系统参数，各个系统中都不尽相同。要么是4个字节(32位),8个字节(64个字节）
2. I/O设备
	- 是系统和外部世界的联系通道
	- 实例系统包括4个部件
		1. 作为用户输入的键盘和鼠标
		2. 作为用户输出的显示屏
		3. 用于长期存储数据和程序的磁盘驱动器
	- 每个I/O设备都通过一个控制器或适配器与I/O总线相连。
		- 区别
			- 控制器是I/O设备本身或者系统的主印制电路板(主板)上的芯片组
			- 适配器是一块插在主板插槽上的卡。
		- 功能
			- 都是在I/O总线和I/O设备之间传递信息
3. 主存
	- 是一个临时存储设备，处理器执行程序时，用来存放程序和程序处理的数据。
	- 物理上
		- 是一组动态随机存储存储器(DRAM)芯片组成的。
	- 逻辑上
		- 是一个线性的字节数组，每个字节都有唯一的地址(数组索引)，这些地址是从零开始的。
4. 处理器
	- 中央处理单元(CPU）
		- 是解释(或执行)存储在主存中的指定引擎，处理器的核心是大小为一个字的存储设备(或寄存器),称为程序计数器(PC).
		- 任何时刻PC都指向主存中的某条机器语言指令(包含该指令的地址)
		- CPU简单操作
			1. 加载
				- 从主存负责一个字节或者一个字到寄存器，以覆盖寄存器原来的内容
			2. 存储
				- 从寄存器复制一个字节或者一个字到主存的某个位置，以覆盖这个位置原来的内容
			3. 操作
				- 把两个寄存器的内容复制到ALU,ALU对这两个字做算术预算，并将结果存放到一个寄存器中，以覆盖该寄存器原来的内容
			4. 跳转
				- 从指令本身抽取一个字，并将这个字复制到程序计数器(PC)中，以覆盖PC中原来的值。

#### 高速缓存
- 针对处理器与主存之间的差异，系统设计者采用更小更快的存储设备。
	- 作为暂时的集结区域，存放处理器近期可能会需要的信息。
- 高速缓存是用一种叫做静态随机访问存储器(SRAM)的硬件技术实现的。

#### 存储设备形成层次结构
- 从上至下。设备的访问速度越来越慢，容量越来越大，且每个字节的造价也越来越便宜
- 思想
	- 上一层的存储器作为低一层存储器的高速缓存

#### 操作系统管理硬件
- 操作系统看作是应用程序何硬件之间插入的一层软件
- 功能
	1. 防止硬件被失控的应用程序滥用
	2. 向应用程序提供简单一致的机制来控制复杂而又通常大不相同的低级硬件。
- 实现
	- 操作系统通过几个基本的抽象概念(进程，虚拟内存何文件)来实现

#### 进程
- 是操作系统对一个正在运行的程序的一种抽象
- 并发运行
	- 是说一个进程的指令何另一个进程的指令交错执行
- 上下文
	- 操作系统保持跟踪进程进行所需的所有状态信息

#### 线程
- 一个进程实际上可以由多个称为线程的执行单元组成，每个线程都运行在进程的上下文中，并共享同样的代码和全局数据

#### 虚拟内存
- 是一个抽象概念，为每个进程提供了一个假象，即每个进程都在独占地使用主存。
- 各个区，最低的地址，逐步向上
	1. 程序代码和数据
		- 对所有进程，代码是从同一固定地址开始，紧接着的是和C全局变量相对应的数据位置，直接按照可执行目标文件的内容初始化的
	2. 堆
		- 堆可以在运行时动态的扩展和收缩
	3. 共享库
		- 在地址空间的中间部分存储像C标准库和数学库的共享库的代码和数据的区域
	4. 栈
		- 位于用户虚拟地址空间顶部的是用户栈，编译器实现函数调用，在程序执行期间可以动态地扩展和收缩
	5. 内核虚拟内存
		- 顶部的区域是为内核保留的。

#### 文件
- 字节序列。向应用程序提供了一个统一的视图。

#### Amdahl定律
- 想要显著加速整个系统，必须提升全系统中相当大的部分的速度

#### 并发和并行
- 并发
	- 指一个同时具有多个活动的系统
- 并行
	- 用并发使一个系统运行得更快
- 并发在计算机系统层次的应用
	1. 线程级并发
		- 能够设计出同时具有多个程序执行的系统。
		- 超线程
			- 同时多线程，是一项允许一个CPU执行多个控制流的技术。
	2. 指令级并行
		- 可以同时执行多条指令的属性
		- 流水线
			- 在流水线中，执行一条指令所需要的活动划分为不同的步骤，将处理器的硬件组织成一系列的阶段，每个阶段执行一个步骤
		- 超标量
			- 处理器达到比一个周期一条指令更快的执行效率
	3. 单指令，多数据并行
		- 允许一条指令产生多个可以并行的操作

#### 计算机系统中抽象的重要性
- 处理器中：指令集架构提供了对实际处理器硬件的抽象。
- 文件是对I/O设备的抽象
- 虚拟内存是对程序存储器的抽象
- 进程是对一个正在运行的程序的抽象
- 虚拟机提供对整个计算机的抽象

#### 总结
- 计算机系统是由硬件和系统软件组成的，他们共同协作以运行应用程序。计算机内部的信息被表示为一组组的位，他们依据上下文有不同的解释方式。程序被其他程序翻译成不同的形式，开始时是ASCII文本，然后被编译器和链接器翻译成二进制可执行文件。
- 处理器读取并解释存放在主存里的二进制指令。因为计算机花费了大量的时间在内存，I/O设备和CPU寄存器之间复制数据，所以将系统中的存储设备划分成层次结构-CPU寄存器在顶部，接着是多层的硬件高速缓存存储器，DAM主存和磁盘存储器。在层次模型中，位于更高层的存储设备比低层的存储设备要更快，单位比特造价也更高。层次结构中较高层次的存储设备可以作为较低层次设备的高速缓存。通过理解和运用这种存储层次结构的知识，程序员可以优化C程序的性能。
- 操作系统内核是应用程序和硬件之间的煤价。它提供三个基本的抽象
	1. 文件是对I/O设备的抽象
	2. 虚拟内存是对主存和磁盘的抽象
	3. 进程是处理器，主存和I/O设备的抽象
- 网络提供了计算机系统之间通信的手段。从特殊系统的角度来看，网络就是一种I/O设备。